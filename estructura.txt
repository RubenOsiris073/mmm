ESTRUCTURA DEL PROYECTO FISGO-MONKEY-TECH
==========================================

VISIÃ“N GENERAL
==============
Sistema integral de gestiÃ³n de productos y punto de venta (POS) con capacidades de detecciÃ³n mediante inteligencia artificial. Implementa una arquitectura cliente-servidor moderna con refactorizaciÃ³n completa hacia un modelo de datos consolidado centrado en productos.

ARQUITECTURA REFACTORIZADA (2025)
=================================
âœ… CONSOLIDACIÃ“N COMPLETADA:
- EliminaciÃ³n de inventoryService.js y inventoryRoutes.js
- IntegraciÃ³n completa de stock en productService.js
- Modelo de datos unificado: productos con campo 'cantidad' integrado
- EliminaciÃ³n de colecciÃ³n separada de inventario en Firebase
- API centralizada para gestiÃ³n de productos y stock

1. ARQUITECTURA GENERAL
=======================
- AplicaciÃ³n dockerizada (Docker + Docker Compose)
- Arquitectura Cliente-Servidor con separaciÃ³n clara
- Microservicios ligeros con responsabilidades especÃ­ficas
- Base de datos Firebase Firestore con modelo consolidado
- Sistema de autenticaciÃ³n Firebase Auth
- Despliegue containerizado con Nginx

2. BACKEND (Node.js + Express)
==============================

2.1. CONFIGURACIÃ“N
------------------
backend/config/
â”œâ”€â”€ firebaseManager.js      # ConfiguraciÃ³n centralizada de Firebase Admin
â”œâ”€â”€ config.js              # Variables de entorno y configuraciÃ³n
â””â”€â”€ credentials/            # Credenciales encriptadas

2.2. ESTRUCTURA DE DATOS CONSOLIDADA
------------------------------------
COLECCIONES FIREBASE:
- products/                 # ColecciÃ³n principal (incluye stock integrado)
  â”œâ”€â”€ id                   # ID Ãºnico del producto
  â”œâ”€â”€ nombre               # Nombre del producto
  â”œâ”€â”€ precio               # Precio unitario
  â”œâ”€â”€ categoria            # CategorÃ­a del producto
  â”œâ”€â”€ cantidad             # âœ… STOCK INTEGRADO (antes separado)
  â”œâ”€â”€ stockMinimo          # Stock mÃ­nimo para alertas
  â”œâ”€â”€ detectionId          # ID para mapeo con detecciÃ³n IA
  â”œâ”€â”€ precisionDeteccion   # Confianza de la detecciÃ³n
  â”œâ”€â”€ fechaCaducidad       # Fecha de vencimiento
  â”œâ”€â”€ perecedero           # Booleano si es perecedero
  â”œâ”€â”€ ubicacion            # UbicaciÃ³n fÃ­sica
  â””â”€â”€ ...                  # Otros campos del producto

- sales/                    # Ventas realizadas
- inventory_movements/      # Movimientos de stock (auditorÃ­a)

2.3. API REST CONSOLIDADA
-------------------------
backend/routes/
â”œâ”€â”€ productRoutes.js        # âœ… CRUD completo + gestiÃ³n de stock
â”‚   â”œâ”€â”€ GET /api/products                    # Listar productos
â”‚   â”œâ”€â”€ GET /api/products/:id               # Obtener producto especÃ­fico
â”‚   â”œâ”€â”€ POST /api/products                  # Crear producto
â”‚   â”œâ”€â”€ PUT /api/products/:id               # Actualizar producto
â”‚   â”œâ”€â”€ PUT /api/products/:id/stock         # âœ… Actualizar stock
â”‚   â””â”€â”€ DELETE /api/products/:id            # Eliminar producto
â”œâ”€â”€ detectionRoutes.js      # DetecciÃ³n de productos con IA
â”‚   â”œâ”€â”€ POST /api/detection/detect          # Detectar producto en imagen
â”‚   â”œâ”€â”€ GET /api/detection/recent           # Obtener detecciones recientes
â”‚   â””â”€â”€ GET /api/detection/status           # Estado del servicio
â”œâ”€â”€ salesRoutes.js          # GestiÃ³n de ventas
â””â”€â”€ transactionsRoutes.js   # Transacciones financieras

âŒ ELIMINADOS EN REFACTORIZACIÃ“N:
- inventoryRoutes.js        # Funcionalidad movida a productRoutes.js
- inventoryService.js       # LÃ³gica integrada en productService.js

2.4. SERVICIOS REFACTORIZADOS
-----------------------------
backend/services/
â”œâ”€â”€ productService.js       # âœ… SERVICIO PRINCIPAL CONSOLIDADO
â”‚   â”œâ”€â”€ getAllProducts()                    # Obtener todos los productos
â”‚   â”œâ”€â”€ createProduct()                     # Crear producto con stock inicial
â”‚   â”œâ”€â”€ updateProductStock()                # âœ… Actualizar stock integrado
â”‚   â”œâ”€â”€ getProductById()                    # Obtener producto especÃ­fico
â”‚   â””â”€â”€ searchProducts()                    # BÃºsqueda de productos
â”œâ”€â”€ detectionService.js     # DetecciÃ³n con TensorFlow.js
â”‚   â”œâ”€â”€ performDetection()                  # Procesar imagen
â”‚   â”œâ”€â”€ getRecentDetections()               # Historial de detecciones
â”‚   â””â”€â”€ findProductByLabel()                # Mapear detecciÃ³n a producto
â”œâ”€â”€ salesService.js         # Procesamiento de ventas
â”‚   â””â”€â”€ updateProductStock()                # âœ… Usa productService
â””â”€â”€ storageService.js       # Almacenamiento Firebase

2.5. SCRIPTS REFACTORIZADOS
---------------------------
backend/scripts/
â”œâ”€â”€ initializeProducts.js   # âœ… Usa firebaseManager centralizado
â”œâ”€â”€ cleanFakeSales.js      # âœ… Usa firestore admin
â””â”€â”€ generateSales.js       # âœ… Usa firestore admin

2.6. MODELO DE IA
-----------------
backend/models/
â”œâ”€â”€ metadata.json          # Metadatos del modelo TensorFlow
â”œâ”€â”€ model.json            # Arquitectura de la red neuronal
â””â”€â”€ weights.bin           # Pesos entrenados

3. FRONTEND (React.js)
======================

3.1. PÃGINAS PRINCIPALES
------------------------
frontend/src/pages/
â”œâ”€â”€ ProductsPage.jsx                # GestiÃ³n de productos
â”œâ”€â”€ ProductRegistrationPage.jsx    # âœ… NUEVA: Registro con detecciÃ³n IA
â”œâ”€â”€ POSMainPage.jsx                # Punto de venta
â”œâ”€â”€ SalesPage.jsx                  # Historial de ventas
â”œâ”€â”€ DashboardPage.jsx              # Dashboard principal
â””â”€â”€ AuthenticationPage.jsx         # AutenticaciÃ³n

3.2. COMPONENTES DE PRODUCTOS CON IA
-----------------------------------
frontend/src/components/products/
â”œâ”€â”€ CameraDetectionComponent.jsx    # âœ… NUEVO: CÃ¡mara para detecciÃ³n
â”œâ”€â”€ ProductRegistrationForm.jsx    # âœ… NUEVO: Formulario completo
â”œâ”€â”€ ProductUpdateForm.jsx          # âœ… NUEVO: ActualizaciÃ³n de stock
â”œâ”€â”€ ProductGrid.jsx               # CuadrÃ­cula de productos
â”œâ”€â”€ ProductList.jsx               # Lista de productos
â””â”€â”€ [otros componentes existentes]

3.3. SISTEMA POS REFACTORIZADO
------------------------------
frontend/src/components/pos/
â”œâ”€â”€ POSView.jsx                    # âœ… Vista principal (sin webcam temporal)
â”œâ”€â”€ ProductList.jsx               # Lista de productos
â”œâ”€â”€ CartPanel.jsx                 # Panel del carrito
â”œâ”€â”€ PaymentModal.jsx              # Modal de pago
â””â”€â”€ hooks/
    â”œâ”€â”€ useCart.js                # LÃ³gica del carrito
    â”œâ”€â”€ usePayment.js            # Procesamiento de pagos
    â””â”€â”€ useProductData.js         # âœ… Datos de productos consolidados

3.4. SERVICIOS FRONTEND REFACTORIZADOS
--------------------------------------
frontend/src/services/
â”œâ”€â”€ apiService.js                 # âœ… Cliente API consolidado
â”‚   â”œâ”€â”€ getProducts()                      # Obtener productos
â”‚   â”œâ”€â”€ createProduct()                    # âœ… NUEVO: Crear producto
â”‚   â”œâ”€â”€ updateProductStock()               # âœ… Actualizar stock
â”‚   â”œâ”€â”€ triggerDetection()                 # âœ… NUEVO: DetecciÃ³n IA
â”‚   â”œâ”€â”€ getDetections()                    # âœ… NUEVO: Historial detecciones
â”‚   â””â”€â”€ getDetectionStatus()               # âœ… NUEVO: Estado detecciÃ³n
â”œâ”€â”€ storageService.js             # âœ… Refactorizado para usar backend API
â”‚   â”œâ”€â”€ getProducts()                      # âœ… Usa response.data.data
â”‚   â”œâ”€â”€ getProductsWithSafeDates()         # âœ… Manejo de fechas
â”‚   â””â”€â”€ getDetections()                    # âœ… Usa apiService
â””â”€â”€ firebase.js                  # ConfiguraciÃ³n Firebase Client

4. FLUJO DE DETECCIÃ“N DE PRODUCTOS IMPLEMENTADO
==============================================

4.1. FLUJO COMPLETO DE REGISTRO CON CÃMARA
------------------------------------------
```
[Inicio] â†’ [Seleccionar MÃ©todo] â†’ [Activar CÃ¡mara] â†’ [Capturar Imagen]
    â†“
[Enviar a Backend] â†’ [Procesar con TensorFlow] â†’ [Â¿DetecciÃ³n Exitosa?]
    â†“                                                      â†“
[Buscar Producto] â†’ [Â¿Existe?] â†’ [Formulario Simplificado] â†’ [Actualizar Stock]
    â†“                    â†“
[Formulario Completo] â†’ [Crear Producto] â†’ [Establecer Stock Inicial]
```

4.2. COMPONENTES DEL FLUJO
--------------------------
- ProductRegistrationPage.jsx: Coordinador principal
- CameraDetectionComponent.jsx: Captura y detecciÃ³n
- ProductUpdateForm.jsx: Para actualizar stock de productos existentes
- ProductRegistrationForm.jsx: Para productos nuevos

4.3. ENDPOINTS DE DETECCIÃ“N
---------------------------
- POST /api/detection/detect: Procesar imagen
- GET /api/detection/recent: Historial de detecciones
- GET /api/detection/status: Estado del servicio

5. NAVEGACIÃ“N Y RUTAS
====================
frontend/src/App.jsx - Rutas principales:
â”œâ”€â”€ /products                     # GestiÃ³n de productos
â”œâ”€â”€ /products/new                 # Nuevo producto manual
â”œâ”€â”€ /products/register            # âœ… NUEVO: Registro con cÃ¡mara
â”œâ”€â”€ /pos                         # Punto de venta
â”œâ”€â”€ /sales                       # Historial de ventas
â””â”€â”€ /dashboard                   # Dashboard principal

Navigation.jsx - MenÃº lateral:
â”œâ”€â”€ "Productos" â†’ /products
â”œâ”€â”€ "Nuevo Producto" â†’ /products/new
â”œâ”€â”€ "Registrar con CÃ¡mara" â†’ /products/register  # âœ… NUEVO
â”œâ”€â”€ "Punto de Venta" â†’ /pos
â””â”€â”€ [otros enlaces]

6. TECNOLOGÃAS Y DEPENDENCIAS
=============================

6.1. BACKEND
------------
- Node.js + Express.js
- Firebase Admin SDK
- TensorFlow.js (Node)
- Multer para archivos
- CORS, Helmet (seguridad)

6.2. FRONTEND
-------------
- React.js 18+
- React Router DOM
- React Bootstrap
- React Icons
- Axios (HTTP client)
- React Webcam (para cÃ¡mara)  # âœ… NUEVO

6.3. BASE DE DATOS
------------------
- Firebase Firestore (NoSQL)
- Firebase Authentication
- Firebase Storage (imÃ¡genes)

6.4. DEVOPS
-----------
- Docker + Docker Compose
- Nginx (proxy reverso)
- Variables de entorno (.env)

7. ESTADO ACTUAL DEL PROYECTO
=============================

âœ… COMPLETADO:
- RefactorizaciÃ³n completa del modelo de datos
- EliminaciÃ³n de inventoryService e inventoryRoutes
- ConsolidaciÃ³n de stock en productService
- Sistema de detecciÃ³n con cÃ¡mara implementado
- Flujo completo de registro de inventario
- API endpoints para detecciÃ³n
- Componentes frontend para registro con IA
- NavegaciÃ³n actualizada
- Scripts de backend refactorizados

ğŸ”„ EN PROGRESO:
- Testing del flujo completo de detecciÃ³n
- OptimizaciÃ³n de la precisiÃ³n del modelo IA
- Mejoras en la interfaz de usuario

ğŸ“‹ PENDIENTE:
- DocumentaciÃ³n de API completa
- Tests unitarios y de integraciÃ³n
- OptimizaciÃ³n de rendimiento
- Deployment en producciÃ³n

8. PATRONES ARQUITECTÃ“NICOS
==========================
- Single Source of Truth: Productos con stock integrado
- Repository Pattern: AbstracciÃ³n de acceso a datos
- Service Layer: LÃ³gica de negocio centralizada
- Component Composition: ReutilizaciÃ³n de componentes React
- Custom Hooks: LÃ³gica reutilizable en frontend
- API Gateway Pattern: CentralizaciÃ³n de endpoints

9. SEGURIDAD
============
- AutenticaciÃ³n Firebase Auth
- AutorizaciÃ³n por rutas protegidas
- ValidaciÃ³n de datos en backend
- SanitizaciÃ³n de inputs
- CORS configurado
- Headers de seguridad (Helmet)

10. MONITOREO Y LOGS
===================
- Sistema de logging centralizado
- MÃ©tricas de detecciÃ³n IA
- AuditorÃ­a de movimientos de stock
- Logs de errores y excepciones


